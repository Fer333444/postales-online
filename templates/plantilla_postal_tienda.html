
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tienda Premium con Postal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
  <div class="container mx-auto px-4 py-6">
    <h1 class="text-3xl font-bold text-center mb-8">ğŸ“¸ Tu Postal + Tienda</h1>

    <div class="flex flex-wrap justify-center gap-6 mb-12">
      {% if imagen_existe %}
      <div>
        <h2 class="text-lg font-semibold text-center mb-2">ğŸ“· Foto original</h2>
        <img src="{{ ruta_img }}" class="max-w-sm rounded shadow-md border" />
      </div>
      {% endif %}
      {% if postal_existe %}
      <div>
        <h2 class="text-lg font-semibold text-center mb-2">ğŸ“¬ Postal generada</h2>
        <img src="{{ ruta_postal }}" class="max-w-sm rounded shadow-md border" />
      </div>
      {% endif %}
    </div>

    <div>
      <h2 class="text-2xl font-semibold mb-4">ğŸ›ï¸ Productos recomendados</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="bg-white rounded shadow p-4">
          <img src="/static/camiseta_hombre_blanca.jpg" alt="Camiseta" class="mb-3 rounded">
          <h3 class="font-semibold">Camiseta Blanca Hombre</h3>
          <p class="text-sm text-gray-600">ImpresiÃ³n de tu postal incluida</p>
          <p class="font-bold mt-2">$19.99</p>
          <button onclick="addToCart('Camiseta Blanca Hombre', 19.99)" class="mt-3 bg-blue-600 hover:bg-blue-800 text-white px-4 py-2 rounded w-full">AÃ±adir al carrito</button>
        </div>
        <div class="bg-white rounded shadow p-4">
          <img src="/static/taza_personalizada.jpg" alt="Taza" class="mb-3 rounded">
          <h3 class="font-semibold">Taza personalizada</h3>
          <p class="text-sm text-gray-600">Con tu postal impresa</p>
          <p class="font-bold mt-2">$9.99</p>
          <button onclick="addToCart('Taza personalizada', 9.99)" class="mt-3 bg-blue-600 hover:bg-blue-800 text-white px-4 py-2 rounded w-full">AÃ±adir al carrito</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Carrito -->
  <div id="cart-panel" class="fixed top-0 right-0 w-80 bg-white shadow-lg h-full transform translate-x-full transition-transform duration-300 z-50 p-6 overflow-y-auto">
    <h2 class="text-xl font-bold mb-4">ğŸ›’ Tu carrito</h2>
    <div id="cart-items" class="mb-4"></div>
    <div class="font-semibold text-lg">Total: $<span id="cart-total">0.00</span></div>
    <button onclick="finalizarCompra()" class="mt-4 w-full bg-green-600 hover:bg-green-800 text-white py-2 rounded">Finalizar compra</button>
    <button onclick="toggleCart()" class="mt-2 w-full bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 rounded">Cerrar</button>
  </div>

  <button onclick="toggleCart()" class="fixed top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded shadow-lg z-40">ğŸ›’ Carrito</button>

<script>
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  function saveCart() {
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCart();
  }

  function updateCart() {
    const panel = document.getElementById('cart-items');
    const totalSpan = document.getElementById('cart-total');
    panel.innerHTML = '';
    let total = 0;
    cart.forEach((item, index) => {
      total += item.price * item.qty;
      const div = document.createElement('div');
      div.classList.add('mb-3', 'border-b', 'pb-2');
      div.innerHTML = `
        <div class="flex justify-between">
          <div>
            <strong>${item.name}</strong><br>
            <small>$${item.price.toFixed(2)} x ${item.qty}</small>
          </div>
          <button onclick="removeFromCart(${index})" class="text-red-500">ğŸ—‘ï¸</button>
        </div>`;
      panel.appendChild(div);
    });
    totalSpan.textContent = total.toFixed(2);
  }

  function toggleCart() {
    document.getElementById('cart-panel').classList.toggle('translate-x-full');
  }

  function addToCart(name, price) {
    const existing = cart.find(item => item.name === name);
    if (existing) {
      existing.qty += 1;
    } else {
      cart.push({ name, price, qty: 1 });
    }
    saveCart();
  }

  function removeFromCart(index) {
    cart.splice(index, 1);
    saveCart();
  }

  function finalizarCompra() {
    if (cart.length === 0) {
      alert('Tu carrito estÃ¡ vacÃ­o.');
      return;
    }
    const total = cart.reduce((acc, i) => acc + i.price * i.qty, 0);
    const pedido = {
      productos: cart,
      total: parseFloat(total.toFixed(2))
    };

    fetch('/guardar_pedido', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(pedido)
    })
    .then(res => res.json())
    .then(data => {
      if (data.status === 'ok') {
        alert('âœ… Pedido guardado correctamente.');
        cart = [];
        localStorage.removeItem('cart');
        updateCart();
      } else {
        alert('âŒ Error al guardar el pedido.');
      }
    })
    .catch(err => {
      console.error('Error al enviar pedido:', err);
      alert('âŒ Error de conexiÃ³n con el servidor.');
    });
  }

  window.onload = updateCart;
</script>
</body>
</html>
