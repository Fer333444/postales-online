
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Postcard & Tienda</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous">
<script>
function finalizarCompra() {
    if (cart.length === 0) {
        alert('Tu carrito est√° vac√≠o.');
        return;
    }

    const total = cart.reduce((acc, i) => acc + i.price * i.qty, 0);
    const pedido = {
        productos: cart,
        total: parseFloat(total.toFixed(2))
    };

    fetch('/guardar_pedido', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(pedido)
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'ok') {
            alert('‚úÖ Pedido guardado correctamente.');
            cart = [];
            localStorage.removeItem('cart');
            updateCart();
        } else {
            alert('‚ùå Error al guardar el pedido.');
        }
    })
    .catch(err => {
        console.error('Error al enviar pedido:', err);
        alert('‚ùå Error de conexi√≥n con el servidor.');
    });
}
</script>
</script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-10">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold">üì∏ Tu postal y tienda personalizada</h1>
            <button onclick="toggleCart()" class="relative">
                <i class="fas fa-shopping-cart text-2xl text-gray-700"></i>
                <span id="cart-count" class="absolute -top-2 -right-2 bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </button>
        </div>

        <div class="flex flex-wrap justify-center gap-10 mb-12">
            {% if imagen_existe %}
            <div>
                <h2 class="text-xl font-semibold text-center mb-2">Foto original</h2>
                <img src="{{ ruta_img }}" class="max-w-xs rounded shadow" />
            </div>
            {% endif %}
            {% if postal_existe %}
            <div>
                <h2 class="text-xl font-semibold text-center mb-2">Postal generada</h2>
                <img src="{{ ruta_postal }}" class="max-w-xs rounded shadow" />
            </div>
            {% endif %}
        </div>

        <div>
            <h2 class="text-2xl font-bold mb-6">üõçÔ∏è Productos relacionados</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white p-4 rounded shadow">
                    <img src="/static/camiseta_hombre_blanca.jpg" alt="Camiseta hombre" class="mb-3 rounded">
                    <h3 class="font-semibold">Camiseta Hombre Blanca</h3>
                    <p class="text-gray-600 text-sm">100% algod√≥n, disponible en S a XL</p>
                    <button onclick="addToCart('Camiseta Hombre Blanca', 19.99)" class="mt-3 bg-blue-600 hover:bg-blue-800 text-white px-4 py-2 rounded w-full">A√±adir al carrito</button>
                </div>
                <div class="bg-white p-4 rounded shadow">
                    <img src="/static/taza_personalizada.jpg" alt="Taza" class="mb-3 rounded">
                    <h3 class="font-semibold">Taza personalizada</h3>
                    <p class="text-gray-600 text-sm">Con tu postal impresa</p>
                    <button onclick="addToCart('Taza personalizada', 9.99)" class="mt-3 bg-blue-600 hover:bg-blue-800 text-white px-4 py-2 rounded w-full">A√±adir al carrito</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Carrito -->
    <div id="cart-panel" class="fixed top-0 right-0 w-80 bg-white shadow-lg h-full transform translate-x-full transition-transform duration-300 z-50 p-6 overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">üõí Tu carrito</h2>
        <div id="cart-items" class="mb-4"></div>
        <div class="font-semibold text-lg">Total: $<span id="cart-total">0.00</span></div>
        <button onclick="finalizarCompra()" class="mt-4 w-full bg-green-600 hover:bg-green-800 text-white py-2 rounded">Finalizar compra</button>
        <button onclick="toggleCart()" class="mt-2 w-full bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 rounded">Cerrar</button>
    </div>

<script>
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function saveCart() {
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCart();
    }

    function updateCart() {
        const panel = document.getElementById('cart-items');
        const totalSpan = document.getElementById('cart-total');
        const countSpan = document.getElementById('cart-count');
        panel.innerHTML = '';
        let total = 0;
        cart.forEach((item, index) => {
            total += item.price * item.qty;
            const div = document.createElement('div');
            div.classList.add('mb-3', 'border-b', 'pb-2');
            div.innerHTML = `
                <div class="flex justify-between">
                    <div>
                        <strong>${item.name}</strong><br>
                        <small>$${item.price.toFixed(2)} x ${item.qty}</small>
                    </div>
                    <button onclick="removeFromCart(${index})" class="text-red-500">üóëÔ∏è</button>
                </div>
            `;
            panel.appendChild(div);
        });
        totalSpan.textContent = total.toFixed(2);
        countSpan.textContent = cart.reduce((acc, item) => acc + item.qty, 0);
    }

    function toggleCart() {
        const panel = document.getElementById('cart-panel');
        panel.classList.toggle('translate-x-full');
    }

    function addToCart(name, price) {
        const existing = cart.find(item => item.name === name);
        if (existing) {
            existing.qty += 1;
        } else {
            cart.push({ name, price, qty: 1 });
        }
        saveCart();
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        saveCart();
    }

    function finalizarCompra() {
        if (cart.length === 0) {
            alert('Tu carrito est√° vac√≠o.');
            return;
        }
        let resumen = 'Resumen de compra:\n';
        cart.forEach(item => {
            resumen += `${item.qty}x ${item.name} - $${(item.price * item.qty).toFixed(2)}\n`;
        });
        resumen += `\nTotal: $${cart.reduce((acc, i) => acc + i.price * i.qty, 0).toFixed(2)}`;
        alert(resumen);
    }

    window.onload = updateCart;

<script>
function finalizarCompra() {
    if (cart.length === 0) {
        alert('Tu carrito est√° vac√≠o.');
        return;
    }

    const total = cart.reduce((acc, i) => acc + i.price * i.qty, 0);
    const pedido = {
        productos: cart,
        total: parseFloat(total.toFixed(2))
    };

    fetch('/guardar_pedido', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(pedido)
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'ok') {
            alert('‚úÖ Pedido guardado correctamente.');
            cart = [];
            localStorage.removeItem('cart');
            updateCart();
        } else {
            alert('‚ùå Error al guardar el pedido.');
        }
    })
    .catch(err => {
        console.error('Error al enviar pedido:', err);
        alert('‚ùå Error de conexi√≥n con el servidor.');
    });
}
</script>
</script>
</body>
</html>
