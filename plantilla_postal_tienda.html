
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tienda por CategorÃ­a</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="container mx-auto px-4 py-6">
    <h1 class="text-3xl font-bold text-center mb-6">ğŸ“¸ Postal + Tienda</h1>
    <div class="flex flex-wrap justify-center gap-6 mb-10">
      {% if imagen_existe %}
      <div class="text-center">
        <h2 class="text-lg font-semibold mb-2">ğŸ“· Foto original</h2>
        <img src="{{ ruta_img }}" class="max-w-xs rounded shadow border" />
      </div>
      {% endif %}
      {% if postal_existe %}
      <div class="text-center">
        <h2 class="text-lg font-semibold mb-2">ğŸ“¬ Postal generada</h2>
        <img src="{{ ruta_postal }}" class="max-w-xs rounded shadow border" />
      </div>
      {% endif %}
    </div>

    <!-- Postal -->
    <div class="flex flex-wrap justify-center gap-6 mb-12">
      {% if imagen_existe %}
      <div><img src="{{ ruta_img }}" class="max-w-xs rounded shadow border" /></div>
      {% endif %}
      {% if postal_existe %}
      <div><img src="{{ ruta_postal }}" class="max-w-xs rounded shadow border" /></div>
      {% endif %}
    </div>

    <!-- Secciones por categorÃ­a -->
    {% set categorias = {
      "ğŸ‘• Hombre": [
        {"name": "Camiseta Blanca Hombre", "price": 19.99, "img": "/static/camiseta_hombre_blanca.jpg"}
      ],
      "ğŸ‘š Mujer": [
        {"name": "Camiseta Negra Mujer", "price": 19.99, "img": "/static/camiseta_mujer_negra.jpg"}
      ],
      "ğŸ§’ NiÃ±o": [
        {"name": "Camiseta Blanca NiÃ±o", "price": 14.99, "img": "/static/camiseta_nino_blanca.jpg"}
      ],
      "ğŸ‘§ NiÃ±a": [
        {"name": "Camiseta Rosa NiÃ±a", "price": 14.99, "img": "/static/camiseta_nina_rosa.jpg"}
      ]
    } %}

    {% for seccion, productos in categorias.items() %}
    <h2 class="text-2xl font-semibold mb-4 mt-10">{{ seccion }}</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
      {% for producto in productos %}
      <div class="bg-white p-4 rounded shadow text-center">
        <img src="{{ producto.img }}" class="mb-3 rounded mx-auto h-48 object-cover" />
        <h3 class="font-semibold">{{ producto.name }}</h3>
        <p class="text-sm text-gray-600 mt-1">Con tu postal personalizada</p>
        <p class="mt-2 font-bold text-blue-700">${{ producto.price }}</p>
        <button onclick="addToCart('{{ producto.name }}', {{ producto.price }})"
                class="mt-3 bg-blue-600 hover:bg-blue-800 text-white px-4 py-2 rounded w-full">
          AÃ±adir al carrito
        </button>
      </div>
      {% endfor %}
    </div>
    {% endfor %}
  </div>

  <!-- BotÃ³n y panel de carrito -->
  <button onclick="toggleCart()" class="fixed top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded shadow z-50">ğŸ›’ Carrito</button>
  <div id="cart-panel" class="fixed top-0 right-0 w-80 bg-white shadow-lg h-full transform translate-x-full transition-transform duration-300 z-40 p-6 overflow-y-auto">
    <h2 class="text-xl font-bold mb-4">ğŸ›ï¸ Tu carrito</h2>
    <div id="cart-items" class="mb-4 space-y-2"></div>
    <div class="font-semibold text-lg">Total: $<span id="cart-total">0.00</span></div>
    <button onclick="finalizarCompra()" class="mt-4 w-full bg-green-600 hover:bg-green-800 text-white py-2 rounded">Finalizar compra</button>
    <button onclick="toggleCart()" class="mt-2 w-full bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 rounded">Cerrar</button>
  </div>

<script>
let cart = JSON.parse(localStorage.getItem('cart')) || [];

function saveCart() {
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCart();
}

function updateCart() {
  const panel = document.getElementById('cart-items');
  const totalSpan = document.getElementById('cart-total');
  panel.innerHTML = '';
  let total = 0;
  cart.forEach((item, i) => {
    total += item.price * item.qty;
    panel.innerHTML += `
      <div class="flex justify-between items-center border-b pb-2">
        <div>
          <strong>${item.name}</strong><br>
          <small>$${item.price.toFixed(2)} x ${item.qty}</small>
        </div>
        <button onclick="removeFromCart(${i})" class="text-red-500">ğŸ—‘ï¸</button>
      </div>`;
  });
  totalSpan.textContent = total.toFixed(2);
}

function addToCart(name, price) {
  const existing = cart.find(item => item.name === name);
  if (existing) {
    existing.qty += 1;
  } else {
    cart.push({ name, price, qty: 1 });
  }
  saveCart();
}

function removeFromCart(index) {
  cart.splice(index, 1);
  saveCart();
}

function toggleCart() {
  document.getElementById('cart-panel').classList.toggle('translate-x-full');
}

function finalizarCompra() {
  if (cart.length === 0) {
    alert('Carrito vacÃ­o.');
    return;
  }
  const total = cart.reduce((acc, i) => acc + i.price * i.qty, 0);
  fetch('/guardar_pedido', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ productos: cart, total: parseFloat(total.toFixed(2)) })
  }).then(res => res.json())
    .then(data => {
      if (data.status === 'ok') {
        alert('âœ… Pedido guardado');
        cart = [];
        localStorage.removeItem('cart');
        updateCart();
      } else {
        alert('âŒ Error al guardar el pedido');
      }
    });
}

window.onload = updateCart;
</script>
</body>
</html>
